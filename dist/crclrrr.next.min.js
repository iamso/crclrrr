/*!
 * crclrrr - version 0.2.0
 *
 * Made with ❤ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2018 Steve Ottoz
 */
const defaults={size:40,border:3,round:!0,bg:'ghostwhite',progress:'lightgreen',duration:1500,baseClass:'crclrrr',initial:0,easing:(a)=>a};export default class Crclrrr{constructor(a,b={}){var c=Math.floor;this.el=a instanceof Node?a:document.querySelector(a),this.options=Object.assign({},defaults,b),this._defaults=defaults,this.callbacks={},this.ns='http://www.w3.org/2000/svg',this.svg=this.el.querySelector(`.${this.options.baseClass}`),this.bg=this.el.querySelector(`.${this.options.baseClass}-bg`),this.progress=this.el.querySelector(`.${this.options.baseClass}-progress`),this.svg||(this.svg=document.createElementNS(this.ns,'svg'),this.el.appendChild(this.svg)),this.bg||(this.bg=document.createElementNS(this.ns,'circle'),this.svg.appendChild(this.bg)),this.progress||(this.progress=document.createElementNS(this.ns,'circle'),this.svg.appendChild(this.progress)),this.svg.setAttribute('class',this.options.baseClass),this.svg.setAttribute('viewBox',`0 0 ${this.options.size} ${this.options.size}`),this.svg.style.transform='rotate(-90deg)',this.bg.setAttribute('class',`${this.options.baseClass}-bg`),this.bg.setAttribute('cx',this.options.size/2),this.bg.setAttribute('cy',this.options.size/2),this.bg.setAttribute('r',c((this.options.size-this.options.border)/2)),this.bg.style.fill='transparent',this.bg.style.opacity=1,this.bg.style.stroke=this.options.bg,this.bg.style.strokeWidth=this.options.border,this.bg.style.strokeLinecap=this.options.round?'round':'butt',this.progress.setAttribute('class',`${this.options.baseClass}-progress`),this.progress.setAttribute('cx',this.options.size/2),this.progress.setAttribute('cy',this.options.size/2),this.progress.setAttribute('r',c((this.options.size-this.options.border)/2)),this.progress.style.fill='transparent',this.progress.style.opacity=0,this.progress.style.stroke=this.options.progress,this.progress.style.strokeWidth=this.options.border,this.progress.style.strokeLinecap=this.options.round?'round':'butt',this.init()}init(a=this.options.initial){return this.radius=this.progress.getAttribute('r'),this.totalLength=Math.PI*(2*this.radius),this.current=a,this.from=0,this.to=0,this.start=0,this.frame=0,this.progress.style.strokeDasharray=this.totalLength,this._draw(),this}set value(a){this.from=Math.max(this.current,0),this.to=Math.min(+a,100),this.up=this.from<this.to,this.start=Date.now(),this.duration=this.up?(this.to-this.from)*(this.options.duration/100):(this.from-this.to)*(this.options.duration/100),this.el.classList.add('loading'),window.cancelAnimationFrame(this.frame),this._animate()}get value(){return this.current}_animate(){var a=Math.round,b=Math.min,c=Math.max;const d=Date.now(),e=(d-this.start)/this.duration||0,f=this.options.easing(e);if(this.current===this.to){if((this.up&&100!==this.to||!this.up&&0!==this.to)&&Array.isArray(this.callbacks.animated))for(let a of this.callbacks.animated)/^f/.test(typeof a)&&a.apply(this,[this]);return!1}if(this.current>this.to){if(this.up)return!1;this.current=c(b(a(this.from-(this.from-this.to)*f),this.from),this.to)}else if(this.current<this.to){if(!this.up)return!1;this.current=c(b(a(this.from+(this.to-this.from)*f),this.to),this.from)}this._draw(),this.frame=window.requestAnimationFrame(this._animate.bind(this))}_draw(){var a=Math.min,b=Math.max;const c=(100-this.current)/100*this.totalLength;if(this.progress.style.opacity=b(a(this.current,1),0),this.progress.style.strokeDashoffset=a(b(c,0),this.totalLength),(this.up&&100<=this.current||!this.up&&0>=this.current)&&(this.el.classList.remove('loading'),Array.isArray(this.callbacks.complete)))for(let a of this.callbacks.complete)/^f/.test(typeof a)&&a.apply(this,[this])}on(a,b){return Array.isArray(this.callbacks[a])||(this.callbacks[a]=[]),this.callbacks[a].push(b),this}reset(a){return this.init(a),this.el.classList.remove('loading'),this}destroy(){this.el.classList.remove('loading'),this.el.removeChild(this.svg)}}